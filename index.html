<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Saraaa‚ù§Ô∏è ‚Äî For You</title>
  <style>
    :root{
      --bg:#fff7fb; --card:#fff; --muted:#7b6b7b; --accent:#ff7aa2; --glass: rgba(255,255,255,0.6);
      --radius:18px; --soft-shadow: 0 6px 20px rgba(98, 24, 59, 0.08);
      --max-width:900px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:linear-gradient(180deg,#fff7fb 0%, #f9f2f8 100%); color:#3b2b36; margin:0; display:flex; justify-content:center; padding:20px}
    .app{width:100%; max-width:var(--max-width);}header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
.brand{display:flex;align-items:center;gap:10px}
.logo{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#ffd0e0,#ffb6d1);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;box-shadow:var(--soft-shadow)}
h1{font-size:18px;margin:0}
nav{margin-left:auto;display:flex;gap:8px}
nav button{background:var(--card);border:none;padding:10px 14px;border-radius:12px;box-shadow:var(--soft-shadow);cursor:pointer}

main{background:var(--card);border-radius:22px;padding:16px;box-shadow:var(--soft-shadow)}

/* Pages */
.pages{display:block}
.page{display:none;padding:6px}
.page.active{display:block}
.hidden-page{display:none}

/* soft card */
.card{background:var(--glass);backdrop-filter:blur(6px);border-radius:14px;padding:12px;margin-bottom:12px}

/* Images + messages grid */
.images-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.img-card{display:flex;gap:10px;border-radius:14px;overflow:hidden;align-items:flex-start}
.img-card img{width:100%;height:auto;aspect-ratio:9/16;object-fit:cover;border-radius:12px}
.msg{flex:1;padding:8px;max-height:220px;overflow:auto}

/* smaller screens */
@media (max-width:520px){
  .images-grid{grid-template-columns:1fr}
  .logo{width:46px;height:46px}
}

/* Notepad */
.notepad{display:flex;flex-direction:column}
textarea{min-height:240px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);padding:12px;font-size:15px}
.btn-row{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
.btn{padding:10px 14px;border-radius:12px;border:none;cursor:pointer}
.accent{background:linear-gradient(90deg,var(--accent),#ffb3cf);color:white;box-shadow:0 6px 18px rgba(255,122,162,0.14)}

/* Memory lane timeline */
.timeline{display:flex;flex-direction:column;gap:12px}
.memory{display:flex;gap:12px;align-items:flex-start}
.memory img{width:120px;height:210px;object-fit:cover;border-radius:12px}
.memory .meta{flex:1}
.memory .meta small{color:var(--muted)}

/* Games layout */
.games-list{display:flex;gap:12px;flex-wrap:wrap}
.game-card{flex:1;min-width:200px;background:var(--card);padding:12px;border-radius:12px;box-shadow:var(--soft-shadow)}

/* Dots & Boxes game */
.game-board{display:grid;place-items:center;padding:12px}
.board{display:grid;gap:6px}
.row{display:flex;gap:6px}
.dot{width:12px;height:12px;border-radius:50%;background:#8b6a7b}
.edge{width:48px;height:18px;border-radius:8px;background:transparent;display:flex;align-items:center;justify-content:center}
.edge.h{width:48px;height:18px}
.edge.v{width:18px;height:48px}
.edge button{width:100%;height:100%;border:none;background:linear-gradient(90deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));border-radius:10px;cursor:pointer}
.edge.taken{background:linear-gradient(90deg,#ffdbe8,#ffc7df)}
.box{width:48px;height:48px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700}

/* modal */
.modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.35)}
.modal .mcard{background:var(--card);padding:18px;border-radius:14px;max-width:420px;text-align:center}
.modal.show{display:flex}

/* small helpers */
.muted{color:var(--muted)}

  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">S‚ù§Ô∏è</div>
        <div>
          <h1>Saraaa‚ù§Ô∏è ‚Äî For You</h1>
          <small class="muted">Surprise website with games & memories</small>
        </div>
      </div>
      <nav>
        <button data-page="home">Home</button>
        <button data-page="page1">Images</button>
        <button data-page="page2">Games</button>
        <button data-page="page3">Notepad</button>
        <button data-page="page4">Memory Lane</button>
      </nav>
    </header><main>
  <section class="pages">
    <!-- Home / Game + status -->
    <div id="home" class="page active">
      <div class="card">
        <strong>Win 3 consecutive Dots & Boxes games to unlock the hidden pages.</strong>
        <div class="muted" style="font-size:13px;margin-top:6px">Consecutive wins saved locally in your browser.</div>
      </div>

      <!-- PLACEHOLDER: If you want to remove the game entirely, add the comment string exactly: <!-- hide game --> anywhere in the HTML (example: right above this template). The JS will detect it and skip rendering the game. -->

      <!-- hide game -->

      <template id="game-template">
        <div class="card game-card">
          <h3>Dots &amp; Boxes ‚Äî Play vs AI</h3>
          <div class="muted">CHANCE_TO_MISTAKE is adjustable in JS.</div>
          <div style="display:flex;gap:10px;align-items:center;margin-top:8px;flex-wrap:wrap">
            <div>Score: <span id="score-info">You 0 ‚Äî 0 AI</span></div>
            <div>Consecutive wins: <strong id="consec">0</strong></div>
            <button id="reset-score" class="btn">Reset</button>
            <button id="new-game" class="btn accent">New Round</button>
          </div>
          <div id="game-area" style="margin-top:14px"></div>
        </div>
      </template>

      <div id="game-root"></div>
    </div>

    <!-- Page 1: Images + Messages -->
    <div id="page1" class="page hidden-page">
      <div class="card">
        <h3>Images & Messages</h3>
        <div class="images-grid" id="images-grid">
          <!-- Image cards will be injected. Use local files in /images/ (9:16). Example: /images/pic1.jpg -->
        </div>
      </div>
    </div>

    <!-- Page 2: Lovely games (Mini Jigsaw & Reaction Heart) -->
    <div id="page2" class="page hidden-page">
      <div class="card">
        <h3>Lovely Games</h3>
        <div class="games-list">
          <div class="game-card" id="jigsaw-card">
            <h4>Mini Jigsaw (Photo Puzzle)</h4>
            <div id="puzzle-area"></div>
          </div>
          <div class="game-card" id="reaction-card">
            <h4>Reaction Heart</h4>
            <div id="reaction-area"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Page 3: Notepad -->
    <div id="page3" class="page hidden-page">
      <div class="card notepad">
        <h3>Notepad for Her</h3>
        <textarea id="note" placeholder="Write your message to Saraaa..." ></textarea>
        <div class="btn-row">
          <button id="download-note" class="btn accent">Download Message</button>
        </div>
      </div>
    </div>

    <!-- Page 4: Memory Lane -->
    <div id="page4" class="page hidden-page">
      <div class="card">
        <h3>Memory Lane</h3>
        <div class="timeline" id="timeline"></div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <input id="mem-img" placeholder="/images/picX.jpg" />
          <input id="mem-date" placeholder="Date (optional)" />
          <input id="mem-caption" placeholder="Short caption" />
          <button id="add-memory" class="btn">Add</button>
        </div>
      </div>
    </div>

  </section>
</main>

  </div>  <!-- Simple modal for winner / image viewer -->  <div id="modal" class="modal"><div class="mcard"><div id="modal-content"></div><div style="margin-top:12px"><button id="modal-close" class="btn">Close</button></div></div></div>  <script>
    /* ----------------------- CONFIG ----------------------- */
    // Adjust AI difficulty here
    const CHANCE_TO_MISTAKE = 0.35; // change to 0.5 easier, 0.2 harder

    // Images that the site will use. Place your 9:16 photos in /images/ and update these filenames.
    const SITE_IMAGES = [
      '/images/pic1.jpg',
      '/images/pic2.jpg',
      '/images/pic3.jpg',
      '/images/pic4.jpg'
    ];

    // Messages to show below images (same length as SITE_IMAGES or will be truncated/filled)
    const IMAGE_MESSAGES = [
      'You look like a dream in this one...',
      'My favourite memory with you.',
      'Every time I see you, my heart misses a beat.',
      'For all the quiet, tender moments.'
    ];

    /* --------------------- NAV & PAGES --------------------- */
    document.querySelectorAll('nav button').forEach(b=>b.addEventListener('click',()=>{
      const page = b.dataset.page;
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      const el = document.getElementById(page);
      if(el){el.classList.add('active')}
    }));

    // Inject images grid
    const imagesGrid = document.getElementById('images-grid');
    SITE_IMAGES.forEach((src,i)=>{
      const container = document.createElement('div'); container.className='img-card card';
      const img = document.createElement('img'); img.src=src; img.alt='photo-'+(i+1);
      const msg = document.createElement('div'); msg.className='msg'; msg.innerHTML = IMAGE_MESSAGES[i] || '';
      container.appendChild(img); container.appendChild(msg);
      imagesGrid.appendChild(container);
    });

    /* --------------------- Memory Lane --------------------- */
    const timeline = document.getElementById('timeline');
    function renderTimeline(){
      const mems = JSON.parse(localStorage.getItem('memories')||'[]');
      timeline.innerHTML='';
      mems.forEach(m=>{
        const wrap = document.createElement('div'); wrap.className='memory card';
        const img = document.createElement('img'); img.src=m.img; img.alt='mem'; img.loading='lazy'; img.addEventListener('click',()=>openModal(`<img src='${m.img}' style='width:100%;height:auto;border-radius:12px'/>`));
        const meta = document.createElement('div'); meta.className='meta'; meta.innerHTML = `<div><strong>${m.caption||'A memory'}</strong></div><small>${m.date||''}</small><div style='margin-top:8px'><button class='btn' onclick="editMemory('${m.id}')">Add note</button></div>`;
        wrap.appendChild(img); wrap.appendChild(meta);
        timeline.appendChild(wrap);
      });
    }
    function editMemory(id){
      const mems = JSON.parse(localStorage.getItem('memories')||'[]');
      const m = mems.find(x=>x.id===id);
      const note = prompt('Add a small note', m.note||'');
      if(note!=null){ m.note = note; localStorage.setItem('memories',JSON.stringify(mems)); renderTimeline(); }
    }
    document.getElementById('add-memory').addEventListener('click',()=>{
      const img=document.getElementById('mem-img').value.trim();
      const date=document.getElementById('mem-date').value.trim();
      const caption=document.getElementById('mem-caption').value.trim();
      if(!img){ alert('Provide image path (e.g. /images/pic1.jpg)'); return }
      const mems = JSON.parse(localStorage.getItem('memories')||'[]');
      mems.unshift({id:Date.now().toString(),img,caption,date});
      localStorage.setItem('memories',JSON.stringify(mems)); renderTimeline();
      document.getElementById('mem-img').value=''; document.getElementById('mem-caption').value=''; document.getElementById('mem-date').value='';
    });
    renderTimeline();

    /* -------------------- Notepad Download -------------------- */
    document.getElementById('download-note').addEventListener('click',()=>{
      const text = document.getElementById('note').value;
      const blob = new Blob([text],{type:'text/plain'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'message-for-saraaa.txt'; a.click();
    });

    /* -------------------- Modal -------------------- */
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modal-content');
    document.getElementById('modal-close').addEventListener('click',()=>{modal.classList.remove('show')});
    function openModal(html){ modalContent.innerHTML = html; modal.classList.add('show'); }

    /* ------------------ Reaction Heart Game ------------------ */
    (function buildReaction(){
      const area = document.getElementById('reaction-area');
      area.innerHTML='';
      const wrap = document.createElement('div'); wrap.style='position:relative;height:120px;overflow:hidden;border-radius:12px;padding:8px';
      const heart = document.createElement('div'); heart.textContent='‚ù§Ô∏è'; heart.style='position:absolute;left:8px;top:30px;font-size:28px;transform:translateX(0);transition:transform 0.08s linear;cursor:pointer';
      const zone = document.createElement('div'); zone.style='position:absolute;left:40%;width:20%;top:0;bottom:0;border-radius:12px;pointer-events:none;'; zone.innerHTML='';
      wrap.appendChild(heart); wrap.appendChild(zone); area.appendChild(wrap);
      let dir=1; let raf;
      function frame(){
        const cur = parseFloat(heart.style.transform.replace('translateX(','').replace('px)',''))||0;
        const next = cur + dir*6; heart.style.transform = `translateX(${next}px)`;
        const left = heart.getBoundingClientRect().left; const zoneRect = zone.getBoundingClientRect();
        if(next>wrap.clientWidth-50 || next<0) dir*=-1;
        raf = requestAnimationFrame(frame);
      }
      raf = requestAnimationFrame(frame);
      heart.addEventListener('click',()=>{
        const hRect = heart.getBoundingClientRect(); const zRect = zone.getBoundingClientRect();
        const overlap = Math.min(hRect.right,zRect.right)-Math.max(hRect.left,zRect.left);
        if(overlap>10){ openModal('<h3>Perfect! ‚ù§Ô∏è</h3><p>You got it ‚Äî sweet timing.</p>'); }
        else openModal('<h3>Close! üòä</h3><p>Try again for the perfect moment.</p>');
      });
    })();

    /* -------------------- Mini Jigsaw Puzzle -------------------- */
    (function buildPuzzle(){
      const area = document.getElementById('puzzle-area'); area.innerHTML='';
      const canvas = document.createElement('div'); canvas.style='width:240px;height:426px;position:relative;overflow:hidden;border-radius:12px';
      area.appendChild(canvas);
      const imgSrc = SITE_IMAGES[0] || '';
      const rows=3, cols=3; // 9 pieces by default
      const pieces=[];
      const w = 240/cols, h = 426/rows;
      // create pieces
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          const p = document.createElement('div'); p.className='puzzle-piece'; p.style=`position:absolute;width:${w}px;height:${h}px;left:${Math.random()*(240-w)}px;top:${Math.random()*(426-h)}px;border-radius:8px;background-image:url(${imgSrc});background-size:${cols*100}% ${rows*100}%;background-position:${-c*100}% ${-r*100}%;box-shadow:var(--soft-shadow);cursor:grab`;
          p.dataset.r=r; p.dataset.c=c; canvas.appendChild(p); pieces.push(p);
          p.addEventListener('pointerdown',function(e){ this.setPointerCapture(e.pointerId); this.style.zIndex=999; const ox=e.clientX - this.offsetLeft; const oy=e.clientY - this.offsetTop;
            function move(ev){ this.style.left=(ev.clientX-ox)+'px'; this.style.top=(ev.clientY-oy)+'px'; }.bind(this);
            function up(ev){this.releasePointerCapture(e.pointerId); this.style.zIndex=''; document.removeEventListener('pointermove',move); document.removeEventListener('pointerup',up); checkWin();}
            document.addEventListener('pointermove',move); document.addEventListener('pointerup',up);
          });
        }
      }
      function checkWin(){
        const ok = pieces.every(p=>{
          const r=p.dataset.r|0, c=p.dataset.c|0; const dx = Math.abs(p.offsetLeft - c*w); const dy = Math.abs(p.offsetTop - r*h);
          return dx<12 && dy<12;
        });
        if(ok) openModal('<h3>Beautiful! Puzzle complete ‚ù§Ô∏è</h3>');
      }
    })();

    /* ------------------ Dots & Boxes Game ------------------ */
    (function initGame(){
      // If the HTML contains the comment '<!-- hide game -->' the template will not mount.
      const html = document.documentElement.innerHTML;
      if(html.includes('<!-- hide game -->')){
        console.log('Game is hidden by comment marker. To enable the game, remove the comment.');
        // still allow pages to be visible once unlocked previously
        checkUnlockState();
        return;
      }

      const tpl = document.getElementById('game-template');
      const root = document.getElementById('game-root');
      root.appendChild(tpl.content.cloneNode(true));

      // Basic settings
      const SCORE_KEY = 'dotsboxes_score';
      const CONSEC_KEY = 'dotsboxes_consec';
      let score = JSON.parse(localStorage.getItem(SCORE_KEY)||'{"you":0,"ai":0}');
      let consec = parseInt(localStorage.getItem(CONSEC_KEY)||'0');
      const scoreInfo = document.getElementById('score-info');
      const consecEl = document.getElementById('consec');
      const resetBtn = document.getElementById('reset-score');
      const newGameBtn = document.getElementById('new-game');
      const gameArea = document.getElementById('game-area');

      function updateScoreUI(){ scoreInfo.textContent = `You ${score.you} ‚Äî ${score.ai} AI`; consecEl.textContent = consec; }
      updateScoreUI();

      resetBtn.addEventListener('click',()=>{ score={you:0,ai:0}; consec=0; localStorage.removeItem(SCORE_KEY); localStorage.removeItem(CONSEC_KEY); updateScoreUI(); checkUnlockState(); });

      newGameBtn.addEventListener('click',()=>{ setupBoard(); });

      // Board model: for simplicity use 3x3 boxes (4x4 dots)
      const BOX_R=3, BOX_C=3;
      let horEdges, verEdges, boxes; // arrays
      let currentPlayer='you';

      function setupBoard(){
        // horizontal edges: (BOX_R+1) x BOX_C
        horEdges = Array.from({length:BOX_R+1}, ()=> Array(BOX_C).fill(false));
        // vertical edges: BOX_R x (BOX_C+1)
        verEdges = Array.from({length:BOX_R}, ()=> Array(BOX_C+1).fill(false));
        boxes = Array.from({length:BOX_R}, ()=> Array(BOX_C).fill(null));
        currentPlayer='you';
        renderBoard();
      }

      function renderBoard(){
        gameArea.innerHTML='';
        const boardWrap = document.createElement('div'); boardWrap.className='game-board';
        const board = document.createElement('div'); board.className='board';
        board.style.gridTemplateColumns = `repeat(${BOX_C*2+1}, auto)`;

        for(let r=0;r<BOX_R*2+1;r++){
          const row = document.createElement('div'); row.className='row';
          for(let c=0;c<BOX_C*2+1;c++){
            if(r%2===0 && c%2===0){ const d = document.createElement('div'); d.className='dot'; row.appendChild(d); }
            else if(r%2===0 && c%2===1){ // horizontal edge
              const er = r/2, ec = (c-1)/2;
              const ewrap = document.createElement('div'); ewrap.className='edge h';
              const btn = document.createElement('button'); btn.dataset.type='h'; btn.dataset.r=er; btn.dataset.c=ec; if(horEdges[er][ec]) btn.classList.add('taken');
              btn.addEventListener('click',edgeClick);
              ewrap.appendChild(btn); row.appendChild(ewrap);
            }
            else if(r%2===1 && c%2===0){ // vertical edge
              const er = (r-1)/2, ec = c/2;
              const ewrap = document.createElement('div'); ewrap.className='edge v';
              const btn = document.createElement('button'); btn.dataset.type='v'; btn.dataset.r=er; btn.dataset.c=ec; if(verEdges[er][ec]) btn.classList.add('taken');
              btn.addEventListener('click',edgeClick);
              ewrap.appendChild(btn); row.appendChild(ewrap);
            }
            else { // box
              const br = (r-1)/2, bc = (c-1)/2; const box = document.createElement('div'); box.className='box'; box.textContent = boxes[br][bc] ? (boxes[br][bc]==='you' ? 'üòä' : 'ü§ñ') : '';
              row.appendChild(box);
            }
          }
          board.appendChild(row);
        }
        boardWrap.appendChild(board); gameArea.appendChild(boardWrap);
      }

      function edgeClick(e){
        const btn = e.currentTarget; const type=btn.dataset.type; const r=Number(btn.dataset.r); const c=Number(btn.dataset.c);
        if(type==='h'){ if(horEdges[r][c]) return; horEdges[r][c]=true; }
        else{ if(verEdges[r][c]) return; verEdges[r][c]=true; }
        const gained = updateBoxesAfterMove(type,r,c,currentPlayer);
        renderBoard();
        if(gained>0){ // player gets another turn
          // check game over
          if(isGameOver()) finishGame(); else return; 
        }
        // switch player
        currentPlayer = (currentPlayer==='you') ? 'ai' : 'you';
        if(currentPlayer==='ai'){ setTimeout(aiMove,400); }
      }

      function updateBoxesAfterMove(type,r,c,player){
        let gained=0;
        for(let br=0;br<BOX_R;br++)for(let bc=0;bc<BOX_C;bc++){
          if(boxes[br][bc]) continue;
          const top = horEdges[br][bc];
          const bottom = horEdges[br+1][bc];
          const left = verEdges[br][bc];
          const right = verEdges[br][bc+1];
          if(top && bottom && left && right){ boxes[br][bc]=player; gained++; }
        }
        return gained;
      }

      function isGameOver(){
        for(let r=0;r<BOX_R;r++)for(let c=0;c<BOX_C;c++) if(!boxes[r][c]) return false; return true;
      }

      function finishGame(){
        const flat = boxes.flat(); const you = flat.filter(x=>x==='you').length; const ai = flat.filter(x=>x==='ai').length;
        if(you>ai){ score.you++; consec++; localStorage.setItem(SCORE_KEY,JSON.stringify(score)); localStorage.setItem(CONSEC_KEY,consec); updateScoreUI(); openModal(`<h3>You won! ‚ù§Ô∏è</h3><p>Score ${you} ‚Äî ${ai}</p>`); }
        else if(ai>you){ score.ai++; consec=0; localStorage.setItem(SCORE_KEY,JSON.stringify(score)); localStorage.setItem(CONSEC_KEY,consec); updateScoreUI(); openModal(`<h3>AI won ü§ñ</h3><p>Score ${you} ‚Äî ${ai}</p>`); }
        else { consec=0; localStorage.setItem(CONSEC_KEY,consec); openModal(`<h3>Draw</h3><p>Score ${you} ‚Äî ${ai}</p>`); }
        checkUnlockState();
      }

      function checkUnlockState(){
        // if consec >=3 then reveal pages
        const pages = document.querySelectorAll('.hidden-page');
        if(consec>=3){ pages.forEach(p=>p.classList.remove('hidden-page')); // hide game UI
          const g = document.getElementById('game-root'); if(g) g.style.display='none';
          openModal('<h3>Unlocked!</h3><p>All pages are now visible. üéâ</p>');
        }
        updateScoreUI();
      }

      // AI Implementation (Minimax-lite with CHANCE_TO_MISTAKE)
      function aiMove(){
        // collect legal moves
        const moves = [];
        for(let r=0;r<horEdges.length;r++) for(let c=0;c<horEdges[0].length;c++) if(!horEdges[r][c]) moves.push({type:'h',r,c});
        for(let r=0;r<verEdges.length;r++) for(let c=0;c<verEdges[0].length;c++) if(!verEdges[r][c]) moves.push({type:'v',r,c});
        if(moves.length===0) return;

        // Evaluate each move with shallow minimax / greedy depth
        let best=null; let bestScore=-Infinity;
        for(const m of moves){ const score = evaluateMove(m, /*depth*/4); if(score>bestScore){ bestScore=score; best=m; }}

        // CHANCE_TO_MISTAKE -> pick random suboptimal move sometimes
        if(Math.random()<CHANCE_TO_MISTAKE){ // pick slightly worse move intentionally
          const alt = moves[Math.floor(Math.random()*moves.length)]; if(alt) best = alt;
        }

        // play chosen move
        if(best.type==='h') horEdges[best.r][best.c]=true; else verEdges[best.r][best.c]=true;
        const gained = updateBoxesAfterMove(best.type,best.r,best.c,'ai');
        renderBoard();
        if(gained>0){ if(isGameOver()) finishGame(); else setTimeout(aiMove,300); }
        else{ currentPlayer='you'; if(isGameOver()) finishGame(); }
      }

      function evaluateMove(move, depth){
        // clone board
        const he = horEdges.map(row=>row.slice());
        const ve = verEdges.map(row=>row.slice());
        const bx = boxes.map(row=>row.slice());
        // apply move
        if(move.type==='h') he[move.r][move.c]=true; else ve[move.r][move.c]=true;
        let score = 0;
        // immediate boxes gained by AI
        for(let r=0;r<BOX_R;r++)for(let c=0;c<BOX_C;c++){
          if(bx[r][c]) continue;
          const top = he[r][c]; const bottom = he[r+1][c]; const left = ve[r][c]; const right = ve[r][c+1];
          if(top && bottom && left && right) score+=1;
        }
        // penalty if move gives opponent an immediate box opportunity
        // count edges that make boxes with 3 sides (i.e., dangerous moves)
        let danger=0;
        for(let r=0;r<BOX_R;r++)for(let c=0;c<BOX_C;c++){
          if(bx[r][c]) continue;
          const top = he[r][c]; const bottom = he[r+1][c]; const left = ve[r][c]; const right = ve[r][c+1];
          const sides = [top,bottom,left,right].filter(Boolean).length;
          if(sides===3) danger++;
        }
        score -= danger*0.9;
        return score + (Math.random()*0.01); // tiny noise to break ties
      }

      setupBoard(); checkUnlockState();
    })();

  </script></body>
</html>
